<!DOCTYPE html>
<html>
	
	<head>
        <title>How to generate PDFs from Gitbook automatically using CI tools</title>
    
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
        <meta property="og:title" content="How to generate PDFs from Gitbook automatically using CI tools" />
        <meta property="og:description" content="Gitbook is an open-source utility that makes it easy to generate well-formatted documentation and e-books. Combining the workflow with Travis is easy too. Trying to generate a PDF automatically though, inside the Travis environment had some hiccups. This is how to get around it." />
        <meta property="og:image" content= />
        <meta property="og:image:width" content="400" />
        <meta property="og:image:height" content="300" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content=https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html />
        <meta property="article:published_time" content="2018-08-08T00:00:00+00:00">
        <meta property="article:author" content="https://akshata.dev">
        <meta property="og:site_name" content='Blog by Akshata Mohanty' />
        <meta property="og:type" content='Blog by Akshata Mohanty' />
        
        <meta itemprop="keywords" content="" />
        
        
            
        <!-- Latest compiled and minified CSS for Bootstrap -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
        <!-- main stylesheet -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
        <link rel="stylesheet" type="text/css" href="/styles/main.css">
        <link href='https://akshata.dev/feed.xml' rel='alternate' type='application/atom+xml'>
    
            <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111560396-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
    
            gtag('config', 'UA-111560396-1');
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [{
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://akshata.dev.com/"
            },{
                "@type": "ListItem",
                "position": 2,
                "name": "Blog",
                "item": "https://akshata.dev/blog"
            },{
                "@type": "ListItem",
                "position": 3,
                "name": How to generate PDFs from Gitbook automatically using CI tools,
                "item": https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html
            }]
        }
        </script>
    </head>

	<main class="container post-wrapper blog-post-container ">
		<a class='back' href='/blog'>Back to blog</a>
		<article> 
			<div class='blog-post__content'>
				<div class='post__meta'>
					<span class='date'>August 2018</span>
					<span class='marker'></span>
				</div>
				<h1 class='post__title'>
					How to generate PDFs from Gitbook automatically using CI tools
				</h1>
				<br>
				<p>Gitbook is an open-source utility that makes it easy to generate well-formatted documentation and e-books. Combining the workflow with Travis is easy too. Trying to generate a PDF automatically though, inside the Travis environment had some hiccups. This is how to get around it.</p>
				<br><br><hr /><br><br>
				<div class='post__content'><h1 id="what-is-gitbook">What is Gitbook?</h1>

<p>Gitbook is an excellent opensource platform to generate awesome looking documentation and books from simple markdown files. They also have a paid version with an editor. However, the open source free version can easily be paired with Github and Travis to pretty much provide a nice workflow.</p>

<p><br /></p>

<h1 id="the-requirement">The Requirement</h1>

<p>The book in question was hosted on Github as Markdowns organised into folders in the <code class="highlighter-rouge">master</code> branch. Travis was then configured to run a command <code class="highlighter-rouge">gitpub</code> that automatically generated the Gitbook, cleans it up and commits it to the <code class="highlighter-rouge">gh-pages</code> branch, from which the github.io page is served. However, we also needed the <code class="highlighter-rouge">master</code> branch to have a directly downloadable PDF version of the latest Gitbook output.</p>

<p><br /></p>

<h1 id="the-problem">The Problem</h1>
<p>Generating a PDF with Gitbook is fairly straightforward using the <code class="highlighter-rouge">gitbook pdf &lt;gitbook-folder-location&gt; &lt;pdf-location&gt;.pdf</code> command. However, running this command inside Travis.CI throws the following Runtime Error.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>File "/usr/bin/ebook-convert", line 20, in &lt;module&gt;
    sys.exit(main())
...
...
...
RuntimeError: X server required. If you are running on a headless machine, use xvfb
</code></pre></div></div>

<p>As is obvious from the error, the error comes from the ebook-convert plugin, that is required by Gitbook for the PDF generation. However, the command <code class="highlighter-rouge">ebook-convert</code> needs to have prepended with <code class="highlighter-rouge">xbvf</code> to run in a headless environment like Travis.</p>

<p>And …</p>

<p>There is no direct way to prepend the <code class="highlighter-rouge">ebook-convert</code> because that is getting called by Gitbook internally. Trying to change that, would mean modifying Gitbook for yourself.</p>

<p><br /></p>

<h1 id="the-solution">The Solution</h1>

<p>I found this <a href="https://www.systutorials.com/241364/how-to-run-gitbook-on-a-headless-server-make-calibre-run-in-headless-server/">gold nugget</a> which didn’t work for me but definitely led me to my current solution. The workaround was to ‘wrap’ the <code class="highlighter-rouge">ebook-convert</code> command so that when Gitbook calls <code class="highlighter-rouge">ebook-convert</code>, it is actually calling the wrapper command, that calls the actual command prepended with <code class="highlighter-rouge">xbvf</code>.</p>

<p>Steps:</p>
<ul>
  <li>Create a wrapper shell script in the repository (script provided below)</li>
  <li>Rename the ebook-covert in your <code class="highlighter-rouge">/usr/bin</code> folder to ebook-convert2 (or something else!)</li>
  <li>Move your script to the <code class="highlighter-rouge">/usr/bin</code> folder as <code class="highlighter-rouge">ebook-convert</code></li>
  <li>Allow the script to be excutable (the command will exit with an error if you don’t do this)</li>
</ul>

<p>And that’s it! Enjoy your automatic PDFs</p>

<h1 id="files">Files</h1>

<p><br /></p>

<h2 id="wrapper-script">wrapper-script</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"Run xvfb-run /usr/bin/ebook-convert2 </span><span class="nv">$@</span><span class="s2">"</span>
<span class="nb">sudo </span>xvfb-run /usr/bin/ebook-convert2 <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>
<p><br /></p>

<h2 id="travisyml">.travis.yml</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  language: node_js
  node_js:
    - "6"
  before_install:
    - sudo apt-get install -y calibre
    - sudo apt-get install xvfb
  before_script:
    - npm install gitbook-cli
    - npm install gitbook-publish@latest
    - npm install ebook-convert
    - sudo mv /usr/bin/ebook-convert /usr/bin/ebook-convert2
    - sudo cp ./ebook-wrapper.sh /usr/bin/ebook-convert
    - sudo chmod +x /usr/bin/ebook-convert
  script: 
    - git config --global user.email "akshatamohanty@gmail.com"
    - git config --global user.name "Akshata"
    - gitbook pdf ./ ./published/urban-prototyping.pdf
    - git add ./published/urban-prototyping.pdf
    - git status
    - git commit -m"Published PDF" 
    - git status
    - git push "https://{USER_NAME}:${GITHUB_TOKEN}@github.com/${GITHUB_REPO}" master
    - gitpub
    - git branch
    - git remote -v
    - git push --force "https://{USER_NAME}:${GITHUB_TOKEN}@github.com/${GITHUB_REPO}" gh-pages 
</code></pre></div></div>
<p><br /></p>
</div>
				<br>
			</div>
		</article>
		<p>
    <h3>Liked this article? Please share!</h3>
    <div class="social-media-icons">
        <a class="twitter-share-button"
            href="https://twitter.com/intent/tweet?text=How to generate PDFs from Gitbook automatically using CI tools by @akshatamohanty&url=https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html"
            target="_blank"
            data-size="large">
            <i class="fa fa-twitter"></i>
        </a>
        <a target="_blank" 
            href="https://www.linkedin.com/sharing/share-offsite/?url=https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html">
            <i class="fa fa-linkedin"></i>
        </a>
        <a target="_blank" 
            href='http://www.reddit.com/submit?url=https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html&title=How+to+generate+PDFs+from+Gitbook+automatically+using+CI+tools%20by%20@akshatamohanty'>
            <i class="fa fa-reddit"></i>
        </a>
        <a href="whatsapp://send?text=How+to+generate+PDFs+from+Gitbook+automatically+using+CI+tools%20by%20Akshata Mohanty%20https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html" 
            data-action="share/whatsapp/share">
            <i class="fa fa-whatsapp"></i>
        </a>
        <a target="_blank" 
            href="http://news.ycombinator.com/submitlink?u=https://akshata.dev/blog_Automated-PDF-Generation-With-Gitbook-and-Travis.html&t=How to generate PDFs from Gitbook automatically using CI tools by Akshata Mohanty">
            <i class="fa fa-y-combinator"></i>
        </a>
    </div>
</p>
<br />

		<hr />
		<br>
		<h3>About the author</h3>
		<br>
		<br>
		<header class='main'>
	<div class='img--profile'></div>
	<br>
	<h2 class='main__title'>Akshata Mohanty</h2>

	<div class='off-black small-text'>
		<div class='subtext'>
			<b><a class='link' href='http://viki.com/' target='_blank'>FULLSTACK DEVELOPER @  Viki</a></li></b>
		</div>
		<hr/>
		Autodidact. Previously <a class='link' href='https://www.sde.nus.edu.sg/' target='_blank'>NUS</a>, <a class='link' href='https://flipkart.com' target='_blank'>Flipkart</a>. Studied Architecture at <a class='link' href='https://iitkgp.ac.in/' target='_blank'>IITKgp</a>. I code for fun and food, in that order.
		
		<br><br>
	
		<ul class='list--no-bullets'>
			<li ><a class='link off-black' href='/'>Home</a></li>
			<li ><a class='link off-black' href='/blog'>Blog</a></li>
			<li ><a class='link off-black' href='/fullstack'>Fullstack</a></li>
			<li ><a class='link off-black' href='/datascience'>Data Science</a></li>
			<li ><a class='link off-black' href='/publications'>Publications</a></li>
		</ul>

		<hr />
		<p>
    <div class='off-black small-text'>Got an idea? Let's nerd it out.</div>
    <div class="social-media-icons">
        <a target="_blank" href="https://linkedin.com/in/akshatamohanty"><i class="fa fa-linkedin"></i></a>
        <a target="_blank" href="https://twitter.com/@akshatamohanty"><i class="fa fa-twitter"></i></a>
        <a target="_blank" href="https://github.com/akshatamohanty"><i class="fa fa-github"></i></a>
    </div>
</p>
		
		<br>

		<div class='email-subscription'>
    <h3>Signup for my newsletter</h3>
    <p class='subtext'>Subscribe to get my latest content by email</p>
    <!-- Begin Mailchimp Signup Form -->
    <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
        /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
        We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
    </style>
    <style type="text/css">
        #mc-embedded-subscribe-form input[type=checkbox]{display: inline; width: auto;margin-right: 10px;}
        #mergeRow-gdpr {margin-top: 20px;}
        #mergeRow-gdpr fieldset label {font-weight: normal;}
        #mc-embedded-subscribe-form .mc_fieldset{border:none;min-height: 0px;padding-bottom:0px;}
    </style>
    <div id="mc_embed_signup">
    <form action="https://gmail.us20.list-manage.com/subscribe/post?u=f0dbc85b497f66ccf6cce0ea5&amp;id=f5d3d71b25" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
        
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f0dbc85b497f66ccf6cce0ea5_f5d3d71b25" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
        </div>
    </form>
    </div>
    <!--End mc_embed_signup-->
</div>
		<br>
		<small class='off-black'> © All Rights Reserved.</small>
	</div>
</header>

	</main>

</html>